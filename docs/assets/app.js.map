{"version":3,"file":"app.js","sources":["../../src/javascript/_misc.js","../../src/javascript/view/essay.js","../../src/javascript/app.js"],"sourcesContent":["export default function () {\n\tlet doc = document;\n\n\t// UA marking\n\tconst UA_LIST = ['iPhone', 'iPad', 'MQQBrowser', 'Android', 'MicroMessenger'];\n\tlet ua = navigator.userAgent;\n\tlet $html = doc.getElementsByTagName('html')[0];\n\tfor (let i = 0; i < UA_LIST.length; i++) {\n\t\tvar uaRegExp = new RegExp(UA_LIST[i]);\n\t\t\n\t\tif (ua.match(uaRegExp)) {\n\t\t\t$html.classList.add('ua-' + UA_LIST[i]);\n\t\t}\n\t}\n\tif (ua.indexOf('Safari') !== -1 && ua.indexOf('Chrome') === -1) {\n\t\t$html.classList.add('ua-Safari');\n\t}\n\tif (!('ontouchstart' in window)) {\n\t\t$html.classList.add('ua-Pointer');\n\t}\n\n\t// Enable the CSS `:active` interactions\n\tdoc.getElementsByTagName('body')[0].addEventListener('touchstart', function(){});\n\tdoc.getElementsByTagName('main')[0].addEventListener('touchstart', function(){});\n\n\t// Twist HTML language\n\tdoc.getElementsByTagName('html')[0].setAttribute('lang', 'en');\n}\n","/* global Han */\n\nexport default function () {\n\t\nlet doc = document;\nlet win = window;\n\n\n\n// Init Han.css\nHan(doc.querySelector('.article'))\n.initCond()\n.renderElem()\n.renderHanging()\n.renderJiya()\n.renderHWS()\n.correctBasicBD()\n.substCombLigaWithPUA();\n\n\n\n// Positioning footnotes\nconst SCREEN_WIDTH_THRESHOLD = 896;\n\nlet $wrap       = doc.querySelector('.article');\nlet $body       = doc.querySelector('.article-body');\nlet $footnote   = doc.querySelector('.article-footnote');\nlet $allFnItems = doc.querySelectorAll('.article-footnote li');\nlet $allFnMarks = doc.querySelectorAll('.article-body .fn-mark');\nlet wrapTop, bodyWidth, bodyPLeft, bodyPWidth, winWidth;\n\nlet fnPositionSide = function () {\n\twrapTop    = $wrap.offsetTop;\n\tbodyWidth  = $body.offsetWidth;\n\tbodyPLeft  = $body.querySelector('p').offsetLeft;\n\tbodyPWidth = $body.querySelector('p').offsetWidth;\n\t\n\t$footnote.style.top   = wrapTop + 'px';\n\t$footnote.style.right = bodyWidth - bodyPLeft - bodyPWidth + 'px';\n\t$footnote.style.width = '';\n\t\n\tfor (let i = 0; i < $allFnItems.length; i++) {\n\t\tlet $crntItem   = $allFnItems[i];\n\t\tlet $crntMark   = $allFnMarks[i];\n\t\tlet crntMarkTop = $crntMark.offsetTop;\n\t\t\n\t\t$crntItem.style.top = crntMarkTop + 'px';\n\t\t$crntItem.style.left = $crntItem.style.right = '';\n\t\t$crntItem.style.setProperty('--arrow-left', '');\n\t}\n};\nlet funPositionInline = function () {\n\twrapTop    = $wrap.offsetTop;\n\tbodyWidth  = $body.offsetWidth;\n\tbodyPLeft  = $body.querySelector('p').offsetLeft;\n\tbodyPWidth = $body.querySelector('p').offsetWidth;\n\t\n\t$footnote.style.top   = wrapTop + 'px';\n\t$footnote.style.right = bodyWidth - bodyPLeft - bodyPWidth + 'px';\n\t$footnote.style.width = bodyPWidth + 'px';\n\t\n\t// Compute the line-height of <p>\n\tlet pLH = win.getComputedStyle(doc.querySelector('.article-body p')).getPropertyValue('line-height');\n\tpLH = pLH.substring(0, pLH.length - 2);\n\t\n\tfor (let i = 0; i < $allFnItems.length; i++) {\n\t\tlet $crntItem    = $allFnItems[i];\n\t\tlet $crntMark    = $allFnMarks[i];\n\t\tlet crntMarkTop  = $crntMark.offsetTop;\n\t\tlet crntMarkLeft = $crntMark.offsetLeft;\n\t\t\n\t\t$crntItem.style.top = crntMarkTop + parseInt(pLH, 10) + 'px';\n\t\t\n\t\tif (crntMarkLeft <= bodyWidth / 2) {\n\t\t\t$crntItem.style.left = '0px';\n\t\t} else {\n\t\t\t$crntItem.style.right = '0px';\n\t\t}\n\t\t\n\t\tlet crntItemLeft = $crntItem.offsetLeft;\t// This value is updated by above settings\n\t\tlet arrowLeft = crntMarkLeft - (crntItemLeft + (bodyWidth - bodyPWidth)/2);\n\t\t$crntItem.style.setProperty('--arrow-left', arrowLeft - 2 + 'px');\n\t}\n};\n\nwin.addEventListener('load', function () {\n\twinWidth = win.innerWidth || doc.clientWidth || doc.body.clientWidth;\n\t\n\tif (winWidth > SCREEN_WIDTH_THRESHOLD) {\n\t\tfnPositionSide();\n\t} else {\n\t\tfunPositionInline();\n\t}\n});\nwin.addEventListener('resize', function () {\n\twinWidth = win.innerWidth || doc.clientWidth || doc.body.clientWidth;\n\t\n\tif (winWidth > SCREEN_WIDTH_THRESHOLD) {\n\t\tfnPositionSide();\n\t} else {\n\t\tfunPositionInline();\n\t}\n});\n\nfor (let i = 0; i < $allFnMarks.length; i++) {\n\tlet $crntFnMark = $allFnMarks[i];\n\t\n\t$crntFnMark.addEventListener('click', function (e) {\n\t\te.preventDefault();\n\t\t\n\t\tif (winWidth > SCREEN_WIDTH_THRESHOLD) {\n\t\t\t// Scroll to the related side note\n\t\t} else {\n\t\t\t// Toggle (show/hide) the related inline note\n\t\t\t$allFnItems[i].classList.toggle('is-active');\n\t\t}\n\t\t\n\t\t// Update hash URL without window scrolling\n\t\tlet $target = e.target;\n\t\twhile ( $target && !$target.matches('.article-body a.fn-mark, body') ) {\n\t\t\t$target = $target.parentNode;\n\t\t}\n\t\tif ($target && $target.matches('.article-body a.fn-mark')) {\n\t\t\thistory.pushState({}, '', $target.getAttribute('href'));\n\t\t}\n\t});\n}\ndoc.addEventListener('click', function (e) {\n\tlet $target = e.target;\n\t\n\twhile ( $target && !$target.matches('.article-footnote li.is-active, .fn-mark, body') ) {\n\t\t$target = $target.parentNode;\n\t}\n\t\n\tif ( !($target && $target.matches('.article-footnote li.is-active, .fn-mark')) ) {\n\t\t// Click the area apart from notes or marks, hide all active notes\n\t\tlet $allActiveFnItems = doc.querySelectorAll('.article-footnote li.is-active');\n\t\tfor (let i = 0; i < $allActiveFnItems.length; i++) {\n\t\t\t$allActiveFnItems[i].classList.remove('is-active');\n\t\t}\n\t}\n});\n\n\n}\n","let doc = document;\n\n// Misc\nimport _misc from './_misc';\n_misc();\n\n// Class\n\n\n\n// View\nimport viewEssay from './view/essay';\n\n// View router\nlet view = doc.querySelector('body').classList[0];\n\nswitch (view) {\n\tcase 'essay': {\n\t\tviewEssay();\n\t\tbreak;\n\t}\n}\n\n"],"names":["doc","document","UA_LIST","ua","navigator","userAgent","$html","getElementsByTagName","i","length","uaRegExp","RegExp","match","classList","add","indexOf","window","addEventListener","setAttribute","win","Han","querySelector","initCond","renderElem","renderHanging","renderJiya","renderHWS","correctBasicBD","substCombLigaWithPUA","SCREEN_WIDTH_THRESHOLD","$wrap","$body","$footnote","$allFnItems","querySelectorAll","$allFnMarks","wrapTop","bodyWidth","bodyPLeft","bodyPWidth","winWidth","fnPositionSide","offsetTop","offsetWidth","offsetLeft","style","top","right","width","$crntItem","$crntMark","crntMarkTop","left","setProperty","funPositionInline","pLH","getComputedStyle","getPropertyValue","substring","crntMarkLeft","parseInt","crntItemLeft","arrowLeft","innerWidth","clientWidth","body","$crntFnMark","e","preventDefault","toggle","$target","target","matches","parentNode","history","pushState","getAttribute","$allActiveFnItems","remove","_misc","view","viewEssay"],"mappings":"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"}