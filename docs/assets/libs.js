/*!
 * @license
 * ES6-Promise v4.2.8 | Y. Katz, T. Dale, S. Penner, et al. | MIT License | https://github.com/stefanpenner/es6-promise
 * requestAnimationFrame polyfill | Erik Möller, et al. | MIT license | https://gist.github.com/paulirish/1579671
 * DOM4 | Andrea Giammarchi @WebReflection | MIT license | https://github.com/WebReflection/dom4
 * 漢字標準格式 v3.3.0 | Ethan Chan | MIT License | https://hanzi.pro
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.ES6Promise=t()}(this,(function(){"use strict";function e(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function t(e){return"function"==typeof e}function n(e){q=e}function r(e){B=e}function i(){return function(){return process.nextTick(u)}}function o(){return void 0!==H?function(){H(u)}:s()}function a(){var e=0,t=new U(u),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function c(){var e=new MessageChannel;return e.port1.onmessage=u,function(){return e.port2.postMessage(0)}}function s(){var e=setTimeout;return function(){return e(u,1)}}function u(){for(var e=0;e<F;e+=2){var t,n;(0,G[e])(G[e+1]),G[e]=void 0,G[e+1]=void 0}F=0}function l(){try{var e=Function("return this")().require("vertx");return H=e.runOnLoop||e.runOnContext,o()}catch(e){return s()}}function d(e,t){var n=this,r=new this.constructor(f);void 0===r[Z]&&A(r);var i=n._state;if(i){var o=arguments[i-1];B((function(){return T(i,r,o,n._result)}))}else N(n,r,e,t);return r}function h(e){var t=this;if(e&&"object"==typeof e&&e.constructor===this)return e;var n=new this(f);return E(n,e),n}function f(){}function p(){return new TypeError("You cannot resolve a promise with itself")}function v(){return new TypeError("A promises callback cannot return that same promise.")}function m(e,t,n,r){try{e.call(t,n,r)}catch(e){return e}}function b(e,t,n){B((function(e){var r=!1,i=m(n,t,(function(n){r||(r=!0,t!==n?E(e,n):x(e,n))}),(function(t){r||(r=!0,C(e,t))}),"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,C(e,i))}),e)}function g(e,t){1===t._state?x(e,t._result):2===t._state?C(e,t._result):N(t,void 0,(function(t){return E(e,t)}),(function(t){return C(e,t)}))}function y(e,n,r){n.constructor===e.constructor&&r===d&&n.constructor.resolve===h?g(e,n):void 0===r?x(e,n):t(r)?b(e,n,r):x(e,n)}function E(t,n){if(t===n)C(t,p());else if(e(n)){var r=void 0;try{r=n.then}catch(e){return void C(t,e)}y(t,n,r)}else x(t,n)}function w(e){e._onerror&&e._onerror(e._result),S(e)}function x(e,t){void 0===e._state&&(e._result=t,e._state=1,0!==e._subscribers.length&&B(S,e))}function C(e,t){void 0===e._state&&(e._state=2,e._result=t,B(w,e))}function N(e,t,n,r){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+1]=n,i[o+2]=r,0===o&&e._state&&B(S,e)}function S(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r=void 0,i=void 0,o=e._result,a=0;a<t.length;a+=3)r=t[a],i=t[a+n],r?T(n,r,i,o):i(o);e._subscribers.length=0}}function T(e,n,r,i){var o=t(r),a=void 0,c=void 0,s=!0;if(o){try{a=r(i)}catch(e){s=!1,c=e}if(n===a)return void C(n,v())}else a=i;void 0!==n._state||(o&&s?E(n,a):!1===s?C(n,c):1===e?x(n,a):2===e&&C(n,a))}function _(e,t){try{t((function t(n){E(e,n)}),(function t(n){C(e,n)}))}catch(t){C(e,t)}}function k(){return ee++}function A(e){e[Z]=ee++,e._state=void 0,e._result=void 0,e._subscribers=[]}function L(){return new Error("Array Methods must be provided an Array")}function M(e){return new te(this,e).promise}function z(e){var t=this;return D(e)?new t((function(n,r){for(var i=e.length,o=0;o<i;o++)t.resolve(e[o]).then(n,r)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))}function j(e){var t=this,n=new this(f);return C(n,e),n}function I(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function R(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function O(){var e=void 0;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=ne}var P=void 0,D=P=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},F=0,H=void 0,q=void 0,B=function e(t,n){G[F]=t,G[F+1]=n,2===(F+=2)&&(q?q(u):$())},K="undefined"!=typeof window?window:void 0,Y=K||{},U=Y.MutationObserver||Y.WebKitMutationObserver,W="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),V="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,G=new Array(1e3),$=void 0;$=W?i():U?a():V?c():void 0===K&&"function"==typeof require?l():s();var Z=Math.random().toString(36).substring(2),J=void 0,X=1,Q=2,ee=0,te=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(f),this.promise[Z]||A(this.promise),D(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?x(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&x(this.promise,this._result))):C(this.promise,L())}return e.prototype._enumerate=function e(t){for(var n=0;void 0===this._state&&n<t.length;n++)this._eachEntry(t[n],n)},e.prototype._eachEntry=function e(t,n){var r=this._instanceConstructor,i=r.resolve;if(i===h){var o=void 0,a=void 0,c=!1;try{o=t.then}catch(e){c=!0,a=e}if(o===d&&void 0!==t._state)this._settledAt(t._state,n,t._result);else if("function"!=typeof o)this._remaining--,this._result[n]=t;else if(r===ne){var s=new r(f);c?C(s,a):y(s,t,o),this._willSettleAt(s,n)}else this._willSettleAt(new r((function(e){return e(t)})),n)}else this._willSettleAt(i(t),n)},e.prototype._settledAt=function e(t,n,r){var i=this.promise;void 0===i._state&&(this._remaining--,2===t?C(i,r):this._result[n]=r),0===this._remaining&&x(i,this._result)},e.prototype._willSettleAt=function e(t,n){var r=this;N(t,void 0,(function(e){return r._settledAt(1,n,e)}),(function(e){return r._settledAt(2,n,e)}))},e}(),ne=function(){function e(t){this[Z]=k(),this._result=this._state=void 0,this._subscribers=[],f!==t&&("function"!=typeof t&&I(),this instanceof e?_(this,t):R())}return e.prototype.catch=function e(t){return this.then(null,t)},e.prototype.finally=function e(n){var r=this,i=this.constructor;return t(n)?this.then((function(e){return i.resolve(n()).then((function(){return e}))}),(function(e){return i.resolve(n()).then((function(){throw e}))})):this.then(n,n)},e}();return ne.prototype.then=d,ne.all=M,ne.race=z,ne.resolve=h,ne.reject=j,ne._setScheduler=n,ne._setAsap=r,ne._asap=B,ne.polyfill=O,ne.Promise=ne,ne.polyfill(),ne})),function(){"use strict";for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),i=window.setTimeout((function(){t(n+r)}),r);return e=n+r,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),function(e){"use strict";function t(){return d.createDocumentFragment()}function n(e){return d.createElement(e)}function r(e,t){if(!e)throw new Error("Failed to construct "+t+": 1 argument required, but only 0 present.")}function i(e){if(1===e.length)return o(e[0]);for(var n=t(),r=R.call(e),i=0;i<e.length;i++)n.appendChild(o(r[i]));return n}function o(e){return"object"==typeof e?e:d.createTextNode(e)}for(var a,c,s,u,l,d=e.document,h=Object.prototype.hasOwnProperty,f=Object.defineProperty||function(e,t,n){return h.call(n,"value")?e[t]=n.value:(h.call(n,"get")&&e.__defineGetter__(t,n.get),h.call(n,"set")&&e.__defineSetter__(t,n.set)),e},p=[].indexOf||function e(t){for(var n=this.length;n--&&this[n]!==t;);return n},v=function(e){if(!e)throw"SyntaxError";if(y.test(e))throw"InvalidCharacterError";return e},m=function(e){var t=void 0===e.className,n=t?e.getAttribute("class")||"":e.className,r=t||"object"==typeof n,i=(r?t?n:n.baseVal:n).replace(g,"");i.length&&I.push.apply(this,i.split(y)),this._isSVG=r,this._=e},b={get:function e(){return new m(this)},set:function(){}},g=/^\s+|\s+$/g,y=/\s+/,E=" ",w="classList",x=function e(t,n){return this.contains(t)?n||this.remove(t):(void 0===n||n)&&(n=!0,this.add(t)),!!n},C=e.DocumentFragment&&DocumentFragment.prototype,N=e.Node,S=(N||Element).prototype,T=e.CharacterData||N,_=T&&T.prototype,k=e.DocumentType,A=k&&k.prototype,L=(e.Element||N||e.HTMLElement).prototype,M=e.HTMLSelectElement||n("select").constructor,z=M.prototype.remove,j=e.SVGElement,I=["matches",L.matchesSelector||L.webkitMatchesSelector||L.khtmlMatchesSelector||L.mozMatchesSelector||L.msMatchesSelector||L.oMatchesSelector||function e(t){var n=this.parentNode;return!!n&&-1<p.call(n.querySelectorAll(t),this)},"closest",function e(t){for(var n=this,r;(r=n&&n.matches)&&!n.matches(t);)n=n.parentNode;return r?n:null},"prepend",function e(){var t=this.firstChild,n=i(arguments);t?this.insertBefore(n,t):this.appendChild(n)},"append",function e(){this.appendChild(i(arguments))},"before",function e(){var t=this.parentNode;t&&t.insertBefore(i(arguments),this)},"after",function e(){var t=this.parentNode,n=this.nextSibling,r=i(arguments);t&&(n?t.insertBefore(r,n):t.appendChild(r))},"toggleAttribute",function e(t,n){var r=this.hasAttribute(t);return 1<arguments.length?r&&!n?this.removeAttribute(t):n&&!r&&this.setAttribute(t,""):r?this.removeAttribute(t):this.setAttribute(t,""),this.hasAttribute(t)},"replace",function e(){this.replaceWith.apply(this,arguments)},"replaceWith",function e(){var t=this.parentNode;t&&t.replaceChild(i(arguments),this)},"remove",function e(){var t=this.parentNode;t&&t.removeChild(this)}],R=I.slice,O=I.length;O;O-=2)if((c=I[O-2])in L||(L[c]=I[O-1]),"remove"!==c||z._dom4||((M.prototype[c]=function(){return 0<arguments.length?z.apply(this,arguments):L.remove.call(this)})._dom4=!0),/^(?:before|after|replace|replaceWith|remove)$/.test(c)&&(T&&!(c in _)&&(_[c]=I[O-1]),k&&!(c in A)&&(A[c]=I[O-1])),/^(?:append|prepend)$/.test(c))if(C)c in C||(C[c]=I[O-1]);else try{t().constructor.prototype[c]=I[O-1]}catch(e){}var P;n("a").matches("a")||(L[c]=(P=L[c],function(e){return P.call(this.parentNode?this:t().appendChild(this),e)})),m.prototype={length:0,add:function e(){for(var t=0,n;t<arguments.length;t++)n=arguments[t],this.contains(n)||I.push.call(this,c);this._isSVG?this._.setAttribute("class",""+this):this._.className=""+this},contains:function(e){return function t(n){return-1<(O=e.call(this,c=v(n)))}}([].indexOf||function(e){for(O=this.length;O--&&this[O]!==e;);return O}),item:function e(t){return this[t]||null},remove:function e(){for(var t=0,n;t<arguments.length;t++)n=arguments[t],this.contains(n)&&I.splice.call(this,O,1);this._isSVG?this._.setAttribute("class",""+this):this._.className=""+this},toggle:x,toString:function e(){return I.join.call(this," ")}},j&&!(w in j.prototype)&&f(j.prototype,w,b),w in d.documentElement?((u=n("div")[w]).add("a","b","a"),"a b"!=u&&("add"in(s=u.constructor.prototype)||(s=e.TemporaryTokenList.prototype),l=function(e){return function(){for(var t=0;t<arguments.length;)e.call(this,arguments[t++])}},s.add=l(s.add),s.remove=l(s.remove),s.toggle=x)):f(L,w,b),"contains"in S||f(S,"contains",{value:function(e){for(;e&&e!==this;)e=e.parentNode;return this===e}}),"head"in d||f(d,"head",{get:function(){return a||(a=d.getElementsByTagName("head")[0])}}),function(){for(var t,n=e.requestAnimationFrame,r=e.cancelAnimationFrame,i=["o","ms","moz","webkit"],o=i.length;!r&&o--;)n=n||e[i[o]+"RequestAnimationFrame"],r=e[i[o]+"CancelAnimationFrame"]||e[i[o]+"CancelRequestAnimationFrame"];r||(n?(t=n,n=function(e){var n=!0;return t((function(){n&&e.apply(this,arguments)})),function(){n=!1}},r=function(e){e()}):(n=function(e){return setTimeout(e,15,15)},r=function(e){clearTimeout(e)})),e.requestAnimationFrame=n,e.cancelAnimationFrame=r}();try{new e.CustomEvent("?")}catch(t){e.CustomEvent=function(e,t){function n(n,i){var o=d.createEvent(e);if("string"!=typeof n)throw new Error("An event name must be provided");return"Event"==e&&(o.initCustomEvent=r),null==i&&(i=t),o.initCustomEvent(n,i.bubbles,i.cancelable,i.detail),o}function r(e,t,n,r){this.initEvent(e,t,n),this.detail=r}return n}(e.CustomEvent?"CustomEvent":"Event",{bubbles:!1,cancelable:!1,detail:null})}try{new Event("_")}catch(t){t=function(e){function t(e,t){r(arguments.length,"Event");var n=d.createEvent("Event");return t||(t={}),n.initEvent(e,!!t.bubbles,!!t.cancelable),n}return t.prototype=e.prototype,t}(e.Event||function e(){}),f(e,"Event",{value:t}),Event!==t&&(Event=t)}try{new KeyboardEvent("_",{})}catch(t){t=function(t){function n(e){for(var t=[],n=["ctrlKey","Control","shiftKey","Shift","altKey","Alt","metaKey","Meta","altGraphKey","AltGraph"],r=0;r<n.length;r+=2)e[n[r]]&&t.push(n[r+1]);return t.join(" ")}function i(e,t){for(var n in t)t.hasOwnProperty(n)&&!t.hasOwnProperty.call(e,n)&&(e[n]=t[n]);return e}function o(e,t,n){try{t[e]=n[e]}catch(e){}}function a(t,a){r(arguments.length,"KeyboardEvent"),a=i(a||{},s);var l=d.createEvent(u),h=a.ctrlKey,f=a.shiftKey,p=a.altKey,v=a.metaKey,m=a.altGraphKey,b=c>3?n(a):null,g=String(a.key),y=String(a.char),E=a.location,w=a.keyCode||(a.keyCode=g)&&g.charCodeAt(0)||0,x=a.charCode||(a.charCode=y)&&y.charCodeAt(0)||0,C=a.bubbles,N=a.cancelable,S=a.repeat,T=a.locale,_=a.view||e,k;if(a.which||(a.which=a.keyCode),"initKeyEvent"in l)l.initKeyEvent(t,C,N,_,h,p,f,v,w,x);else if(0<c&&"initKeyboardEvent"in l){switch(k=[t,C,N,_],c){case 1:k.push(g,E,h,f,p,v,m);break;case 2:k.push(h,p,f,v,w,x);break;case 3:k.push(g,E,h,p,f,v,m);break;case 4:k.push(g,E,b,S,T);break;default:k.push(char,g,E,b,S,T)}l.initKeyboardEvent.apply(l,k)}else l.initEvent(t,C,N);for(g in l)s.hasOwnProperty(g)&&l[g]!==a[g]&&o(g,l,a);return l}var c=0,s={char:"",key:"",location:0,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1,altGraphKey:!1,repeat:!1,locale:navigator.language,detail:0,bubbles:!1,cancelable:!1,keyCode:0,charCode:0,which:0},u;try{var l=d.createEvent("KeyboardEvent");l.initKeyboardEvent("keyup",!1,!1,e,"+",3,!0,!1,!0,!1,!1),c="+"==(l.keyIdentifier||l.key)&&3==(l.keyLocation||l.location)&&(l.ctrlKey?l.altKey?1:3:l.shiftKey?2:4)||9}catch(e){}return u=0<c?"KeyboardEvent":"Event",a.prototype=t.prototype,a}(e.KeyboardEvent||function e(){}),f(e,"KeyboardEvent",{value:t}),KeyboardEvent!==t&&(KeyboardEvent=t)}try{new MouseEvent("_",{})}catch(t){t=function(t){function n(t,n){r(arguments.length,"MouseEvent");var i=d.createEvent("MouseEvent");return n||(n={}),i.initMouseEvent(t,!!n.bubbles,!!n.cancelable,n.view||e,n.detail||1,n.screenX||0,n.screenY||0,n.clientX||0,n.clientY||0,!!n.ctrlKey,!!n.altKey,!!n.shiftKey,!!n.metaKey,n.button||0,n.relatedTarget||null),i}return n.prototype=t.prototype,n}(e.MouseEvent||function e(){}),f(e,"MouseEvent",{value:t}),MouseEvent!==t&&(MouseEvent=t)}d.querySelectorAll("*").forEach||function(){function e(e){var t=e.querySelectorAll;e.querySelectorAll=function e(n){var r=t.call(this,n);return r.forEach=Array.prototype.forEach,r}}e(d),e(Element.prototype)}();try{d.querySelector(":scope *")}catch(e){!function(){function e(e,n,r){e.setAttribute(t,null);var i=n.call(e,String(r).replace(/(^|,\s*)(:scope([ >]|$))/g,(function(e,n,r,i){return n+"["+t+"]"+(i||" ")})));return e.removeAttribute(t),i}var t="data-scope-"+(1e9*Math.random()>>>0),n=Element.prototype,r=n.querySelector,i=n.querySelectorAll;n.querySelector=function t(n){return e(this,r,n)},n.querySelectorAll=function t(n){return e(this,i,n)}}()}}(window),function(e){"use strict";function t(){}function n(e,t,r){function i(e){i.once&&(e.currentTarget.removeEventListener(e.type,t,i),i.removed=!0),i.passive&&(e.preventDefault=n.preventDefault),"function"==typeof i.callback?i.callback.call(this,e):i.callback&&i.callback.handleEvent(e),i.passive&&delete e.preventDefault}return i.type=e,i.callback=t,i.capture=!!r.capture,i.passive=!!r.passive,i.once=!!r.once,i.removed=!1,i}var r=e.WeakMap||function(){function e(e,t,n){a=n,o=!1,c=void 0,e.dispatchEvent(t)}function t(e){this.value=e}function n(){r++,this.__ce__=new i("@DOMMap:"+r+Math.random())}var r=0,o=!1,a=!1,c;return t.prototype.handleEvent=function e(t){o=!0,a?t.currentTarget.removeEventListener(t.type,this,!1):c=this.value},n.prototype={constructor:n,delete:function t(n){return e(n,this.__ce__,!0),o},get:function t(n){e(n,this.__ce__,!1);var r=c;return c=void 0,r},has:function t(n){return e(n,this.__ce__,!1),o},set:function n(r,i){return e(r,this.__ce__,!0),r.addEventListener(this.__ce__.type,new t(i),!1),this}},n}();t.prototype=(Object.create||Object)(null),n.preventDefault=function e(){};var i=e.CustomEvent,o=e.dispatchEvent,a=e.addEventListener,c=e.removeEventListener,s=0,u=function(){s++},l=[].indexOf||function e(t){for(var n=this.length;n--&&this[n]!==t;);return n},d=function(e){return"".concat(e.capture?"1":"0",e.passive?"1":"0",e.once?"1":"0")},h;try{a("_",u,{once:!0}),o(new i("_")),o(new i("_")),c("_",u,{once:!0})}catch(e){}1!==s&&function(){function i(e){return function r(i,o,c){if(c&&"boolean"!=typeof c){var s=a.get(this),u=d(c),h,f,p;s||a.set(this,s=new t),i in s||(s[i]={handler:[],wrap:[]}),f=s[i],(h=l.call(f.handler,o))<0?(h=f.handler.push(o)-1,f.wrap[h]=p=new t):p=f.wrap[h],u in p||(p[u]=n(i,o,c),e.call(this,i,p[u],p[u].capture))}else e.call(this,i,o,c)}}function o(e){return function t(n,r,i){if(i&&"boolean"!=typeof i){var o=a.get(this),c,s,u,h;if(o&&n in o&&(u=o[n],-1<(s=l.call(u.handler,r))&&(c=d(i))in(h=u.wrap[s]))){for(c in e.call(this,n,h[c],h[c].capture),delete h[c],h)return;u.handler.splice(s,1),u.wrap.splice(s,1),0===u.handler.length&&delete o[n]}}else e.call(this,n,r,i)}}var a=new r;h=function(e){if(e){var t=e.prototype;t.addEventListener=i(t.addEventListener),t.removeEventListener=o(t.removeEventListener)}},e.EventTarget?h(EventTarget):(h(e.Text),h(e.Element||e.HTMLElement),h(e.HTMLDocument),h(e.Window||{prototype:e}),h(e.XMLHttpRequest))}()}(self),function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=t(e,!0):"function"==typeof define&&define.amd?define((function(){return t(e,!0)})):t(e)}("undefined"!=typeof window?window:this,(function(e,t){"use strict";function n(e){return"function"==typeof e||e instanceof Element?e:void 0}function r(e){var t=0===e.index&&e.isEnd?"biaodian cjk":"biaodian cjk portion "+(0===e.index?"is-first":e.isEnd?"is-end":"is-inner"),n=we.create("h-char-group",t);return n.innerHTML=e.text,n}function i(e){var t=we.create("div"),n=e.charCodeAt(0).toString(16);return t.innerHTML='<h-char unicode="'+n+'" class="biaodian cjk '+o(e)+'">'+e+"</h-char>",t.firstChild}function o(e){return e.match(K.char.biaodian.open)?"bd-open":e.match(K.char.biaodian.close)?"bd-close bd-end":e.match(K.char.biaodian.end)?/(?:\u3001|\u3002|\uff0c)/i.test(e)?"bd-end bd-cop":"bd-end":e.match(new RegExp(B.biaodian.liga))?"bd-liga":e.match(new RegExp(B.biaodian.middle))?"bd-middle":""}function a(e,t){var n=we.create("canvas"),r;return n.width="50",n.height="20",n.style.display="none",P.appendChild(n),(r=n.getContext("2d")).textBaseline="top",r.font="15px "+t+", sans-serif",r.fillStyle="black",r.strokeStyle="black",r.fillText(e,0,0),{node:n,context:r,remove:function(){we.remove(n,P)}}}function c(e,t){var n,r=e.context,i=t.context;try{for(var o=1;o<=20;o++)for(var a=1;a<=50;a++){if(void 0===n&&r.getImageData(a,o,1,1).data[3]!==i.getImageData(a,o,1,1).data[3]){n=!1;break}if("boolean"==typeof n)break;50===a&&20===o&&void 0===n&&(n=!0)}return e.remove(),t.remove(),e=null,t=null,n}catch(e){}return!1}function s(e,t,n){var e=e,t,n,r;return t=a(n=n||"辭Q",t=t||"sans-serif"),!c(e=a(n,e),t)}function u(e){var t=we.create("!"),n=e.classList,r,i;return t.appendChild(we.clone(e)),we.tag("rt",t.firstChild).forEach((function(e){var t=we.create("!"),r=[],o;do{if(!(o=(o||e).previousSibling)||o.nodeName.match(/((?:h\-)?r[ubt])/i))break;t.insertBefore(we.clone(o),t.firstChild),r.push(o)}while(!o.nodeName.match(/((?:h\-)?r[ubt])/i));i=n.contains("zhuyin")?v(t,e):p(t,e);try{e.parentNode.replaceChild(i,e),r.map(we.remove)}catch(e){}})),h(t)}function l(e){var t=we.create("!");return t.appendChild(we.clone(e)),we.tag("rt",t.firstChild).forEach((function(e){var t=we.create("!"),n=[],r,i;do{if(!(r=(r||e).previousSibling)||r.nodeName.match(/((?:h\-)?r[ubt])/i))break;t.insertBefore(we.clone(r),t.firstChild),n.push(r)}while(!r.nodeName.match(/((?:h\-)?r[ubt])/i));(i=we.create("rt")).innerHTML=m(e),e.parentNode.replaceChild(i,e)})),t.firstChild}function d(e){var t=we.create("!"),n=e.classList,r,i,o,a,c;return t.appendChild(we.clone(e)),r=t.firstChild,i=o=we.tag("rb",r),a=i.length,(c=r.querySelector("rtc.zhuyin"))&&(o=we.tag("rt",c).map((function(e,t){if(i[t]){var n=v(i[t],e);try{i[t].parentNode.replaceChild(n,i[t])}catch(e){}return n}})),we.remove(c),r.setAttribute("rightangle","true")),we.qsa("rtc:not(.zhuyin)",r).forEach((function(e,t){var i;i=we.tag("rt",e).map((function(e,r){var i=Number(e.getAttribute("rbspan")||1),c=0,s=[],u,l;i>a&&(i=a);do{try{u=o.shift(),s.push(u)}catch(e){}if(void 0===u)break;c+=Number(u.getAttribute("span")||1)}while(i>c);if(i<c){if(s.length>1)return;s=we.tag("rb",s[0]),o=s.slice(i).concat(o),s=s.slice(0,i),c=i}l=p(s,e,{class:n,span:c,order:t});try{s[0].parentNode.replaceChild(l,s.shift()),s.map(we.remove)}catch(e){}return l})),o=i,1===t&&r.setAttribute("doubleline","true"),we.remove(e)})),h(t)}function h(e){var t=e.firstChild,n=we.create("h-ruby");return n.innerHTML=t.innerHTML,we.setAttr(n,t.attributes),n.normalize(),n}function f(e){if(!e instanceof Element)return e;var t=e.classList;return t.contains("pinyin")?t.add("romanization"):t.contains("romanization")?t.add("annotation"):t.contains("mps")?t.add("zhuyin"):t.contains("rightangle")&&t.add("complex"),e}function p(e,t,n){var r=we.create("h-ru"),t=we.clone(t),n;return(n=n||{}).annotation="true",Array.isArray(e)?r.innerHTML=e.map((function(e){return void 0===e?"":e.outerHTML})).join("")+t.outerHTML:(r.appendChild(we.clone(e)),r.appendChild(t)),we.setAttr(r,n),r}function v(e,t){var e=we.clone(e),n=we.create("h-ru");return n.setAttribute("zhuyin",!0),n.appendChild(e),n.innerHTML+=m(t),n}function m(e){var t="string"==typeof e?e:e.textContent,n,r,i;return i=(n=t.replace(K.zhuyin.diao,""))?n.length:0,r=t.replace(n,"").replace(/[\u02C5]/g,"ˇ").replace(/[\u030D\u0358]/g,"̇"),0===i?"":'<h-zhuyin length="'+i+'" diao="'+r+'"><h-yin>'+n+"</h-yin><h-diao>"+r+"</h-diao></h-zhuyin>"}function b(e,t){return e&&t&&e.parentNode===t.parentNode}function g(e,t){var n=e,t=t||"";if(we.isElmt(e.nextSibling)||b(e,e.nextSibling))return t+_e;for(;!n.nextSibling;)n=n.parentNode;return e!==n&&n.insertAdjacentHTML("afterEnd","<h-hws hidden> </h-hws>"),t}function y(e,t){return e.isEnd&&0===e.index?t[1]+_e+t[2]:0===e.index?g(e.node,e.text):e.text}function E(e){return 0===e.index?we.clone(ke):""}function w(e){var t=e.node.parentNode;return 0===e.index&&(Ae=e.endIndexInNode-2),"h-hws"!==t.nodeName.toLowerCase()||1!==e.index&&e.indexInMatch!==Ae||t.classList.add("quote-inner"),e.text}function x(e){var t=e.node.parentNode;return"h-hws"===t.nodeName.toLowerCase()&&t.classList.add("quote-outer"),e.text}function C(){var e=we.create("div"),t;return e.innerHTML="<span>a b</span><span style=\"font-family: 'Han Space'\">a b</span>",P.appendChild(e),t=e.firstChild.offsetWidth!==e.lastChild.offsetWidth,we.remove(e),t}function N(e){var t=e.nextSibling;t&&je(t,"h-cs.jinze-outer")?t.classList.add("hangable-outer"):e.insertAdjacentHTML("afterend",ze)}function S(e){return e.replace(/(biaodian|cjk|bd-jiya|bd-consecutive|bd-hangable)/gi,"").trim()}function T(e){var t=e.text,n=e.node.parentNode,r=we.parent(n,"h-char.biaodian"),i=H.createBDChar(t),o;return i.innerHTML="<h-inner>"+t+"</h-inner>",i.classList.add("bd-jiya"),(o=we.parent(n,"h-jinze"))&&k(o),r?(r.classList.add("bd-jiya"),je(n,"h-inner, h-inner *")?t:i.firstChild):i}function _(e){var t=De,n=e.node.parentNode,r=we.parent(n,"h-char.biaodian"),i=we.parent(r,"h-jinze"),o;return o=r.classList,t&&r.setAttribute("prev",t),Fe&&o.contains("bd-open")&&Fe.pop().setAttribute("next","bd-open"),Fe=void 0,e.isEnd?(De=void 0,o.add("bd-consecutive","end-portion")):(De=S(r.getAttribute("class")),o.add("bd-consecutive")),i&&(Fe=A(i,{prev:t,class:S(r.getAttribute("class"))})),e.text}function k(e){je(e,".tou, .touwei")&&!je(e.previousSibling,"h-cs.jiya-outer")&&e.insertAdjacentHTML("beforebegin",Pe),je(e,".wei, .touwei")&&!je(e.nextSibling,"h-cs.jiya-outer")&&e.insertAdjacentHTML("afterend",Pe)}function A(e,t){var n,r;return je(e,".tou, .touwei")&&(n=e.previousSibling,je(n,"h-cs")&&(n.className="jinze-outer jiya-outer",n.setAttribute("prev",t.prev))),je(e,".wei, .touwei")&&(r=e.nextSibling,je(r,"h-cs")&&(r.className="jinze-outer jiya-outer "+t.class,r.removeAttribute("prev"))),[n,r]}function L(e,t,n){return function(){var r=H.localize.writeOnCanvas(t,e),i=H.localize.writeOnCanvas(n,e);return H.localize.compareCanvases(r,i)}}function M(){return L('"Romanization Sans"',"a̍","󰁡")}function z(){return L('"Romanization Sans"',"i̍","󰁩")}function j(){return L('"Zhuyin Kaiti"',"ㆴ̇","󳆴")}function I(e){return function(t){var t=t||R,n=H.find(t).avoid(qe);return e.forEach((function(e){n.replace(new RegExp(e[0],"ig"),(function(t,n){var r=we.clone(Be);return r.innerHTML="<h-inner>"+n[0]+"</h-inner>",r.setAttribute("display-as",e[1]),0===t.index?r:""}))})),n}}var R=e.document,O=R.documentElement,P=R.body,D="3.3.0",F=["initCond","renderElem","renderJiya","renderHanging","correctBiaodian","renderHWS","substCombLigaWithPUA"],H=function(e,t){return new H.fn.init(e,t)},q=function(e,t){return e&&(this.context=e),t&&(this.condition=t),this};H.version="3.3.0",H.fn=H.prototype={version:"3.3.0",constructor:H,context:P,condition:O,routine:F,init:q,setRoutine:function(e){return Array.isArray(e)&&(this.routine=e),this},render:function(e){var t=this,e;return(e=Array.isArray(e)?e:this.routine).forEach((function(e){"string"==typeof e&&"function"==typeof t[e]?t[e]():Array.isArray(e)&&"function"==typeof t[e[0]]&&t[e.shift()].apply(t,e)})),this}},H.fn.init.prototype=H.fn,H.init=function(){return H.init=H().render()};var B={punct:{base:"[…,.;:!?‽_]",sing:"[‐-—…]",middle:"[\\/~\\-&‐-—_]",open:"['\"‘“\\(\\[¡¿⸘«‹‚“„]",close:"['\"”’\\)\\]»›‛”‟]",end:"['\"”’\\)\\]»›‛”‟‼‽⁇-⁉,.;:!?]"},biaodian:{base:"[︰．、，。：；？！ー]",liga:"[—…⋯]",middle:"[·＼／－゠＆・＿]",open:"[「『《〈（〔［｛【〖]",close:"[」』》〉）〕］｝】〗]",end:"[」』》〉）〕］｝】〗︰．、，。：；？！ー]"},hanzi:{base:"[一-鿿㐀-䶵㇀-㇣〇﨎﨏﨑﨓﨔﨟﨡﨣﨤﨧-﨩]|[\ud800-\udbff][\udc00-\udfff]",desc:"[⿰-⿺]",radical:"[⼀-⿕⺀-⻳]"},latin:{base:"[A-Za-z0-9À-ÿĀ-ſƀ-ɏⱠ-Ɀ꜠-ꟿḀ-ỿ]",combine:"[̀-́᷀-᷿]"},ellinika:{base:"[0-9Ͱ-Ͽἀ-῿]",combine:"[̀-᷀ͅ-᷿]"},kirillica:{base:"[0-9Ѐ-҂Ҋ-ӿԀ-ԯꙀ-ꙮ꙾-ꚗ]",combine:"[҃-҉ⷠ-ⷿ꙯-꙽ꚟ]"},kana:{base:"[アイウエオ-ヺあいうえお-ゔゟヿ]|\ud82c[\udc00-\udc01]",small:"[ぁぃぅぇぉァィゥェォっゃゅょゎゕゖッャュョヮヵヶㇰ-ㇿ]",combine:"[゙-゜]",half:"[ｦ-ﾟ]",mark:"[゠ゝゞ・-ヾ]"},eonmun:{base:"[가-힣]",letter:"[ᄀ-ᇿㅏ-ㅣㄱ-ㆎꥠ-ꥼힰ-ퟻ]",half:"[ﾡ-ￜ]"},zhuyin:{base:"[ㄅ-ㄭㆠ-ㆺ]",initial:"[ㄅ-ㄙㄪ-ㄬㆠ-ㆣ]",medial:"[ㄧ-ㄩ]",final:"[ㄚ-ㄩㄭㆤ-ㆳㆸ-ㆺ]",tone:"[˙ˊ˅ˇˋ˪˫]",checked:"[ㆴ-ㆷ][̇̍͘]?"}},K=(Y="[\\x20\\t\\r\\n\\f]",U=B.punct.open,W=B.punct.close,V=B.punct.end,G=B.punct.middle,$=B.punct.sing,Z=U+"|"+V+"|"+G,J=B.biaodian.open,X=B.biaodian.close,Q=B.biaodian.end,ee=B.biaodian.middle,te=B.biaodian.liga+"{2}",ne=J+"|"+Q+"|"+ee,re=B.kana.base+B.kana.combine+"?",ie=B.kana.small+B.kana.combine+"?",oe=B.kana.half,ae=B.eonmun.base+"|"+B.eonmun.letter,ce=B.eonmun.half,se=B.hanzi.base+"|"+B.hanzi.desc+"|"+B.hanzi.radical+"|"+re,ue=B.ellinika.combine,le=B.latin.base+ue+"*",de=B.ellinika.base+ue+"*",he=B.kirillica.combine,fe=B.kirillica.base+he+"*",me=se+"|(?:"+(pe=le+"|"+de+"|"+fe)+"|['’])+",be=B.zhuyin.initial,ge=B.zhuyin.medial,ye=B.zhuyin.final,Ee=B.zhuyin.tone+"|"+B.zhuyin.checked,{char:{punct:{all:new RegExp("("+Z+")","g"),open:new RegExp("("+U+")","g"),end:new RegExp("("+V+")","g"),sing:new RegExp("("+$+")","g")},biaodian:{all:new RegExp("("+ne+")","g"),open:new RegExp("("+J+")","g"),close:new RegExp("("+X+")","g"),end:new RegExp("("+Q+")","g"),liga:new RegExp("("+te+")","g")},hanzi:new RegExp("("+se+")","g"),latin:new RegExp("("+le+")","ig"),ellinika:new RegExp("("+de+")","ig"),kirillica:new RegExp("("+fe+")","ig"),kana:new RegExp("("+re+"|"+ie+"|"+oe+")","g"),eonmun:new RegExp("("+ae+"|"+ce+")","g")},group:{biaodian:[new RegExp("(("+ne+"){2,})","g"),new RegExp("("+te+J+")","g")],punct:null,hanzi:new RegExp("("+se+")+","g"),western:new RegExp("("+le+"|"+de+"|"+fe+"|"+Z+")+","ig"),kana:new RegExp("("+re+"|"+ie+"|"+oe+")+","g"),eonmun:new RegExp("("+ae+"|"+ce+"|"+Z+")+","g")},jinze:{hanging:new RegExp(Y+"*([、，。．])(?!"+Q+")","ig"),touwei:new RegExp("("+J+"+)("+me+")("+Q+"+)","ig"),tou:new RegExp("("+J+"+)("+me+")","ig"),wei:new RegExp("("+me+")("+Q+"+)","ig"),middle:new RegExp("("+me+")("+ee+")("+me+")","ig")},zhuyin:{form:new RegExp("^˙?("+be+")?("+ge+")?("+ye+")?("+Ee+")?$"),diao:new RegExp("("+Ee+")","g")},hws:{base:[new RegExp("("+se+")("+pe+"|"+U+")","ig"),new RegExp("("+pe+"|"+V+")("+se+")","ig")],strict:[new RegExp("("+se+")"+Y+"?("+pe+"|"+U+")","ig"),new RegExp("("+pe+"|"+V+")"+Y+"?("+se+")","ig")]},"display-as":{"ja-font-for-hant":["查 査","啟 啓","鄉 鄕","值 値","污 汚"],"comb-liga-pua":[["a[̍͘]","󰁡"],["e[̍͘]","󰁥"],["i[̍͘]","󰁩"],["o[̍͘]","󰁯"],["u[̍͘]","󰁵"],["ㆴ[̇̍͘]","󳆴"],["ㆵ[̇̍͘]","󳆵"],["ㆶ[̇̍͘]","󳆶"],["ㆷ[̇̍͘]","󳆷"]],"comb-liga-vowel":[["a[̍͘]","󰁡"],["e[̍͘]","󰁥"],["i[̍͘]","󰁩"],["o[̍͘]","󰁯"],["u[̍͘]","󰁵"]],"comb-liga-zhuyin":[["ㆴ[̇̍͘]","󳆴"],["ㆵ[̇̍͘]","󳆵"],["ㆶ[̇̍͘]","󳆶"],["ㆷ[̇̍͘]","󳆷"]]},"inaccurate-char":[["[•‧]","·"],["⋯⋯","……"],["──","——"],["‵","‘"],["′","’"],["‶","“"],["″","”"]]}),Y,U,W,V,G,$,Z,J,X,Q,ee,te,ne,re,ie,oe,ae,ce,se,ue,le,de,he,fe,pe,ve,me,be,ge,ye,Ee;H.UNICODE=B,H.TYPESET=K,H.UNICODE.cjk=H.UNICODE.hanzi,H.UNICODE.greek=H.UNICODE.ellinika,H.UNICODE.cyrillic=H.UNICODE.kirillica,H.UNICODE.hangul=H.UNICODE.eonmun,H.UNICODE.zhuyin.ruyun=H.UNICODE.zhuyin.checked,H.TYPESET.char.cjk=H.TYPESET.char.hanzi,H.TYPESET.char.greek=H.TYPESET.char.ellinika,H.TYPESET.char.cyrillic=H.TYPESET.char.kirillica,H.TYPESET.char.hangul=H.TYPESET.char.eonmun,H.TYPESET.group.hangul=H.TYPESET.group.eonmun,H.TYPESET.group.cjk=H.TYPESET.group.hanzi;var we={id:function(e,t){return(t||R).getElementById(e)},tag:function(e,t){return this.makeArray((t||R).getElementsByTagName(e))},qs:function(e,t){return(t||R).querySelector(e)},qsa:function(e,t){return this.makeArray((t||R).querySelectorAll(e))},parent:function(e,t){return t?function(){if("function"==typeof we.matches){for(;!we.matches(e,t);){if(!e||e===R.documentElement){e=void 0;break}e=e.parentNode}return e}}():e?e.parentNode:void 0},create:function(e,t){var n="!"===e?R.createDocumentFragment():""===e?R.createTextNode(t||""):R.createElement(e);try{t&&(n.className=t)}catch(e){}return n},clone:function(e,t){return e.cloneNode("boolean"!=typeof t||t)},remove:function(e){return e.parentNode.removeChild(e)},setAttr:function(e,t){if("object"==typeof t){var n=t.length;if("object"==typeof t[0]&&"name"in t[0])for(var r=0;r<n;r++)void 0!==t[r].value&&e.setAttribute(t[r].name,t[r].value);else for(var i in t)t.hasOwnProperty(i)&&void 0!==t[i]&&e.setAttribute(i,t[i]);return e}},isElmt:function(e){return e&&e.nodeType===Node.ELEMENT_NODE},isIgnorable:function(e){return!!e&&("WBR"===e.nodeName||e.nodeType===Node.COMMENT_NODE)},makeArray:function(e){return Array.prototype.slice.call(e)},extend:function(e,t){if(("object"==typeof e||"function"==typeof e)&&"object"==typeof t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}},xe=function(t){function n(e,t,n){var r=Element.prototype,i=r.matches||r.mozMatchesSelector||r.msMatchesSelector||r.webkitMatchesSelector;return e instanceof Element?i.call(e,t):!(!n||!/^[39]$/.test(e.nodeType))}var r="0.2.1",i=t.NON_INLINE_PROSE,o=t.PRESETS.prose.filterElements,a,c=(e||{}).document||void 0;if(void 0===c)throw new Error("Fibre requires a DOM-supported environment.");var s=function(e,t){return new s.fn.init(e,t)};return s.version="0.2.1",s.matches=n,
s.fn=s.prototype={constructor:s,version:"0.2.1",finder:[],context:void 0,portionMode:"retain",selector:{},preset:"prose",init:function(e,t){if(t&&(this.preset=null),this.selector={context:null,filter:[],avoid:[],boundary:[]},!e)throw new Error("A context is required for Fibre to initialise.");return e instanceof Node?e instanceof Document?this.context=e.body||e:this.context=e:"string"==typeof e&&(this.context=c.querySelector(e),this.selector.context=e),this},filterFn:function(e){var t=this.selector.filter.join(", ")||"*",r=this.selector.avoid.join(", ")||null,i=n(e,t,!0)&&!n(e,r);return"prose"===this.preset?o(e)&&i:i},boundaryFn:function(e){var t,r=n(e,this.selector.boundary.join(", ")||null);return"prose"===this.preset&&i(e)||r},filter:function(e){return"string"==typeof e&&this.selector.filter.push(e),this},endFilter:function(e){return e?this.selector.filter=[]:this.selector.filter.pop(),this},avoid:function(e){return"string"==typeof e&&this.selector.avoid.push(e),this},endAvoid:function(e){return e?this.selector.avoid=[]:this.selector.avoid.pop(),this},addBoundary:function(e){return"string"==typeof e&&this.selector.boundary.push(e),this},removeBoundary:function(){return this.selector.boundary=[],this},setMode:function(e){return this.portionMode="first"===e?"first":"retain",this},replace:function(e,n){var r=this;return r.finder.push(t(r.context,{find:e,replace:n,filterElements:function(e){return r.filterFn(e)},forceContext:function(e){return r.boundaryFn(e)},portionMode:r.portionMode})),r},wrap:function(e,n){var r=this;return r.finder.push(t(r.context,{find:e,wrap:n,filterElements:function(e){return r.filterFn(e)},forceContext:function(e){return r.boundaryFn(e)},portionMode:r.portionMode})),r},revert:function(e){var t=this.finder.length,e=Number(e)||(0===e?Number(0):"all"===e?t:1);if(void 0===t||0===t)return this;e>t&&(e=t);for(var n=e;n>0;n--)this.finder.pop().revert();return this}},s.fn.filterOut=s.fn.avoid,s.fn.init.prototype=s.fn,s}(function(){function e(e){return"[object Array]"==u.call(e)}function t(e){return String(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function n(){return r.apply(null,arguments)||i.apply(null,arguments)}function r(e,t,r,o,a){if(t&&!t.nodeType&&arguments.length<=2)return!1;var c="function"==typeof r,s;c&&(s=r,r=function(e,t){return s(e.text,t.startIndex)});var u=i(t,{find:e,wrap:c?null:r,replace:c?r:"$"+(o||"&"),prepMatch:function(e,t){if(!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";if(o>0){var n=e[o];e.index+=e[0].indexOf(n),e[0]=n}return e.endIndex=e.index+e[0].length,e.startIndex=e.index,e.index=t,e},filterElements:a});return n.revert=function(){return u.revert()},!0}function i(e,t){return new o(e,t)}function o(e,t){var r=t.preset&&n.PRESETS[t.preset];if(t.portionMode=t.portionMode||"retain",r)for(var i in r)l.call(r,i)&&!l.call(t,i)&&(t[i]=r[i]);this.node=e,this.options=t,this.prepMatch=t.prepMatch||this.prepMatch,this.reverts=[],this.matches=this.search(),this.matches.length&&this.processMatches()}var a="retain",c="first",s=R,u={}.toString,l={}.hasOwnProperty;return n.NON_PROSE_ELEMENTS={br:1,hr:1,script:1,style:1,img:1,video:1,audio:1,canvas:1,svg:1,map:1,object:1,input:1,textarea:1,select:1,option:1,optgroup:1,button:1},n.NON_CONTIGUOUS_PROSE_ELEMENTS={address:1,article:1,aside:1,blockquote:1,dd:1,div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,main:1,nav:1,noscript:1,ol:1,output:1,p:1,pre:1,section:1,ul:1,br:1,li:1,summary:1,dt:1,details:1,rp:1,rt:1,rtc:1,script:1,style:1,img:1,video:1,audio:1,canvas:1,svg:1,map:1,object:1,input:1,textarea:1,select:1,option:1,optgroup:1,button:1,table:1,tbody:1,thead:1,th:1,tr:1,td:1,caption:1,col:1,tfoot:1,colgroup:1},n.NON_INLINE_PROSE=function(e){return l.call(n.NON_CONTIGUOUS_PROSE_ELEMENTS,e.nodeName.toLowerCase())},n.PRESETS={prose:{forceContext:n.NON_INLINE_PROSE,filterElements:function(e){return!l.call(n.NON_PROSE_ELEMENTS,e.nodeName.toLowerCase())}}},n.Finder=o,o.prototype={search:function(){function e(t){for(var a=0,u=t.length;a<u;++a){var l=t[a];if("string"==typeof l){if(o.global)for(;n=o.exec(l);)c.push(s.prepMatch(n,r++,i));else(n=l.match(o))&&c.push(s.prepMatch(n,0,i));i+=l.length}else e(l)}}var n,r=0,i=0,o=this.options.find,a=this.getAggregateText(),c=[],s=this;return o="string"==typeof o?RegExp(t(o),"g"):o,e(a),c},prepMatch:function(e,t,n){if(!e[0])throw new Error("findAndReplaceDOMText cannot handle zero-length matches");return e.endIndex=n+e.index+e[0].length,e.startIndex=n+e.index,e.index=t,e},getAggregateText:function(){function e(r,i){if(3===r.nodeType)return[r.data];if(t&&!t(r))return[];var i=[""],o=0;if(r=r.firstChild)do{if(3!==r.nodeType){var a=e(r);n&&1===r.nodeType&&(!0===n||n(r))?(i[++o]=a,i[++o]=""):("string"==typeof a[0]&&(i[o]+=a.shift()),a.length&&(i[++o]=a,i[++o]=""))}else i[o]+=r.data}while(r=r.nextSibling);return i}var t=this.options.filterElements,n=this.options.forceContext;return e(this.node)},processMatches:function(){var e=this.matches,t=this.node,n=this.options.filterElements,r,i,o=[],a=t,c=e.shift(),s=0,u=0,l=0,d,h=[t];e:for(;;){if(3===a.nodeType&&(!i&&a.length+s>=c.endIndex?i={node:a,index:l++,text:a.data.substring(c.startIndex-s,c.endIndex-s),indexInMatch:s-c.startIndex,indexInNode:c.startIndex-s,endIndexInNode:c.endIndex-s,isEnd:!0}:r&&o.push({node:a,index:l++,text:a.data,indexInMatch:s-c.startIndex,indexInNode:0}),!r&&a.length+s>c.startIndex&&(r={node:a,index:l++,indexInMatch:0,indexInNode:c.startIndex-s,endIndexInNode:c.endIndex-s,text:a.data.substring(c.startIndex-s,c.endIndex-s)}),s+=a.data.length),d=1===a.nodeType&&n&&!n(a),r&&i){if(a=this.replaceMatch(c,r,o,i),s-=i.node.data.length-i.endIndexInNode,r=null,i=null,o=[],l=0,u++,!(c=e.shift()))break}else if(!d&&(a.firstChild||a.nextSibling)){a.firstChild?(h.push(a),a=a.firstChild):a=a.nextSibling;continue}for(;;){if(a.nextSibling){a=a.nextSibling;break}if((a=h.pop())===t)break e}}},revert:function(){for(var e=this.reverts.length;e--;)this.reverts[e]();this.reverts=[]},prepareReplacementString:function(e,t,n,r){var i=this.options.portionMode;return"first"===i&&t.indexInMatch>0?"":(e=e.replace(/\$(\d+|&|`|')/g,(function(e,t){var r;switch(t){case"&":r=n[0];break;case"`":r=n.input.substring(0,n.startIndex);break;case"'":r=n.input.substring(n.endIndex);break;default:r=n[+t]}return r})),"first"===i?e:t.isEnd?e.substring(t.indexInMatch):e.substring(t.indexInMatch,t.indexInMatch+t.text.length))},getPortionReplacementNode:function(e,t,n){var r=this.options.replace||"$&",i=this.options.wrap;if(i&&i.nodeType){var o=s.createElement("div");o.innerHTML=i.outerHTML||(new XMLSerializer).serializeToString(i),i=o.firstChild}if("function"==typeof r)return(r=r(e,t,n))&&r.nodeType?r:s.createTextNode(String(r));var a="string"==typeof i?s.createElement(i):i;return(r=s.createTextNode(this.prepareReplacementString(r,e,t,n))).data&&a?(a.appendChild(r),a):r},replaceMatch:function(e,t,n,r){var i=t.node,o=r.node,a,c;if(i===o){var u=i;t.indexInNode>0&&(a=s.createTextNode(u.data.substring(0,t.indexInNode)),u.parentNode.insertBefore(a,u));var l=this.getPortionReplacementNode(r,e);return u.parentNode.insertBefore(l,u),r.endIndexInNode<u.length&&(c=s.createTextNode(u.data.substring(r.endIndexInNode)),u.parentNode.insertBefore(c,u)),u.parentNode.removeChild(u),this.reverts.push((function(){a===l.previousSibling&&a.parentNode.removeChild(a),c===l.nextSibling&&c.parentNode.removeChild(c),l.parentNode.replaceChild(u,l)})),l}a=s.createTextNode(i.data.substring(0,t.indexInNode)),c=s.createTextNode(o.data.substring(r.endIndexInNode));for(var d=this.getPortionReplacementNode(t,e),h=[],f=0,p=n.length;f<p;++f){var v=n[f],m=this.getPortionReplacementNode(v,e);v.node.parentNode.replaceChild(m,v.node),this.reverts.push(function(e,t){return function(){t.parentNode.replaceChild(e.node,t)}}(v,m)),h.push(m)}var b=this.getPortionReplacementNode(r,e);return i.parentNode.insertBefore(a,i),i.parentNode.insertBefore(d,i),i.parentNode.removeChild(i),o.parentNode.insertBefore(b,o),o.parentNode.insertBefore(c,o),o.parentNode.removeChild(o),this.reverts.push((function(){a.parentNode.removeChild(a),d.parentNode.replaceChild(i,d),c.parentNode.removeChild(c),b.parentNode.replaceChild(o,b)})),b}},n}()),Ce=((Ne=we.create("div")).appendChild(we.create("","0-")),Ne.appendChild(we.create("","2")),Ne.normalize(),2!==Ne.firstChild.length),Ne;we.extend(xe.fn,{normalize:function(){return Ce&&this.context.normalize(),this},jinzify:function(e){return this.filter(e||null).avoid("h-jinze").replace(K.jinze.touwei,(function(e,t){var n=we.create("h-jinze","touwei");return n.innerHTML=t[0],0===e.index&&e.isEnd||1===e.index?n:""})).replace(K.jinze.wei,(function(e,t){var n=we.create("h-jinze","wei");return n.innerHTML=t[0],0===e.index?n:""})).replace(K.jinze.tou,(function(e,t){var n=we.create("h-jinze","tou");return n.innerHTML=t[0],0===e.index&&e.isEnd||1===e.index?n:""})).replace(K.jinze.middle,(function(e,t){var n=we.create("h-jinze","middle");return n.innerHTML=t[0],0===e.index&&e.isEnd||1===e.index?n:""})).endAvoid().endFilter()},groupify:function(e){var e=we.extend({biaodian:!1,hanzi:!1,kana:!1,eonmun:!1,western:!1},e||{});return this.avoid("h-word, h-char-group"),e.biaodian&&this.replace(K.group.biaodian[0],r).replace(K.group.biaodian[1],r),(e.hanzi||e.cjk)&&this.wrap(K.group.hanzi,we.clone(we.create("h-char-group","hanzi cjk"))),e.western&&this.wrap(K.group.western,we.clone(we.create("h-word","western"))),e.kana&&this.wrap(K.group.kana,we.clone(we.create("h-char-group","kana"))),(e.eonmun||e.hangul)&&this.wrap(K.group.eonmun,we.clone(we.create("h-word","eonmun hangul"))),this.endAvoid(),this},charify:function(e){var e;return(e=we.extend({avoid:!0,biaodian:!1,punct:!1,hanzi:!1,latin:!1,ellinika:!1,kirillica:!1,kana:!1,eonmun:!1},e||{})).avoid&&this.avoid("h-char"),e.biaodian&&this.replace(K.char.biaodian.all,n(e.biaodian)||function(e){return i(e.text)}).replace(K.char.biaodian.liga,n(e.biaodian)||function(e){return i(e.text)}),(e.hanzi||e.cjk)&&this.wrap(K.char.hanzi,n(e.hanzi||e.cjk)||we.clone(we.create("h-char","hanzi cjk"))),e.punct&&this.wrap(K.char.punct.all,n(e.punct)||we.clone(we.create("h-char","punct"))),e.latin&&this.wrap(K.char.latin,n(e.latin)||we.clone(we.create("h-char","alphabet latin"))),(e.ellinika||e.greek)&&this.wrap(K.char.ellinika,n(e.ellinika||e.greek)||we.clone(we.create("h-char","alphabet ellinika greek"))),(e.kirillica||e.cyrillic)&&this.wrap(K.char.kirillica,n(e.kirillica||e.cyrillic)||we.clone(we.create("h-char","alphabet kirillica cyrillic"))),e.kana&&this.wrap(K.char.kana,n(e.kana)||we.clone(we.create("h-char","kana"))),(e.eonmun||e.hangul)&&this.wrap(K.char.eonmun,n(e.eonmun||e.hangul)||we.clone(we.create("h-char","eonmun hangul"))),this.endAvoid(),this}}),we.extend(H,{isNodeNormalizeNormal:Ce,find:xe,createBDGroup:r,createBDChar:i}),we.matches=H.find.matches,["setMode","wrap","replace","revert","addBoundary","removeBoundary","avoid","endAvoid","filter","endFilter","jinzify","groupify","charify"].forEach((function(e){H.fn[e]=function(t,n){return this.finder||(this.finder=H.find(this.context)),this.finder[e](t,n),this}}));var Se={};Se.writeOnCanvas=a,Se.compareCanvases=c,Se.detectFont=s,Se.support=function(){function t(e){var t=e.charAt(0).toUpperCase()+e.slice(1),n,r;return(e+" "+i.join(t+" ")+t).split(" ").forEach((function(e){"string"==typeof o.style[e]&&(r=!0)})),r||!1}function n(e,t){var n=P||we.create("body"),r=we.create("div"),i=P?r:n,t="function"==typeof t?t:function(){},o,a,c;return o=["<style>",e,"</style>"].join(""),i.innerHTML+=o,n.appendChild(r),P||(n.style.background="",n.style.overflow="hidden",c=O.style.overflow,O.style.overflow="hidden",O.appendChild(n)),a=t(i,e),we.remove(i),P||(O.style.overflow=c),!!a}function r(t,n){var r;return e.getComputedStyle?r=R.defaultView.getComputedStyle(t,null).getPropertyValue(n):t.currentStyle&&(r=t.currentStyle[n]),r}var i="Webkit Moz ms".split(" "),o=we.create("h-test"),a;return{columnwidth:t("columnWidth"),fontface:(n('@font-face { font-family: font; src: url("//"); }',(function(e,t){var n=we.qsa("style",e)[0],r=n.sheet||n.styleSheet,i=r?r.cssRules&&r.cssRules[0]?r.cssRules[0].cssText:r.cssText||"":"";a=/src/i.test(i)&&0===i.indexOf(t.split(" ")[0])})),a),ruby:function(){var e=we.create("ruby"),t=we.create("rt"),n=we.create("rp"),i;return e.appendChild(n),e.appendChild(t),O.appendChild(e),i="none"===r(n,"display")||"ruby"===r(e,"display")&&"ruby-text"===r(t,"display"),O.removeChild(e),e=null,t=null,n=null,i}(),"ruby-display":function(){var e=we.create("div");return e.innerHTML='<h-test-a style="display: ruby;"></h-test-a><h-test-b style="display: ruby-text-container;"></h-test-b>',"ruby"===e.querySelector("h-test-a").style.display&&"ruby-text-container"===e.querySelector("h-test-b").style.display}(),"ruby-interchar":function(){var e="inter-character",t=we.create("div"),n;return t.innerHTML='<h-test style="-moz-ruby-position:'+e+";-ms-ruby-position:"+e+";-webkit-ruby-position:"+e+";ruby-position:"+e+';"></h-test>',(n=t.querySelector("h-test").style).rubyPosition===e||n.WebkitRubyPosition===e||n.MozRubyPosition===e||n.msRubyPosition===e}(),textemphasis:t("textEmphasis"),unicoderange:function(){var e;return n('@font-face{font-family:test-for-unicode-range;src:local(Arial),local("Droid Sans")}@font-face{font-family:test-for-unicode-range;src:local("Times New Roman"),local(Times),local("Droid Serif");unicode-range:U+270C}',(function(){e=!Se.detectFont("test-for-unicode-range",'Arial, "Droid Sans"',"Q")})),e}(),writingmode:t("writingMode")}}(),Se.initCond=function(e){var e=e||O,t="",n;for(var r in Se.support)n=(Se.support[r]?"":"no-")+r,e.classList.add(n),t+=n+" ";return t};var Te=Se.support["ruby-interchar"];we.extend(Se,{renderRuby:function(e,t){var t=t||"ruby",n=we.qsa(t,e);we.qsa("rtc",e).concat(n).map(f),n.forEach((function(e){var t=e.classList,n;t.contains("complex")?n=d(e):t.contains("zhuyin")&&(n=Te?l(e):u(e)),n&&e.parentNode.replaceChild(n,e)}))},simplifyRubyClass:f,getZhuyinHTML:m,renderComplexRuby:d,renderSimpleRuby:u,renderInterCharRuby:l}),we.extend(Se,{renderElem:function(e){this.renderRuby(e),this.renderDecoLine(e),this.renderDecoLine(e,"s, del"),this.renderEm(e)},renderDecoLine:function(e,t){var n=we.qsa(t||"u, ins",e),r=n.length;e:for(;r--;){var i=n[r],o=null;do{if(!(o=(o||i).previousSibling))continue e;n[r-1]===o&&i.classList.add("adjacent")}while(we.isIgnorable(o))}},renderEm:function(e,t){var n=t?"qsa":"tag",t=t||"em",r;we[n](t,e).forEach((function(e){var t=H(e);Se.support.textemphasis?t.avoid("rt, h-char").charify({biaodian:!0,punct:!0}):t.avoid("rt, h-char, h-char-group").jinzify().groupify({western:!0}).charify({hanzi:!0,biaodian:!0,punct:!0,latin:!0,ellinika:!0,kirillica:!0})}))}}),H.normalize=Se,H.localize=Se,H.support=Se.support,H.detectFont=Se.detectFont,H.fn.initCond=function(){return this.condition.classList.add("han-js-rendered"),H.normalize.initCond(this.condition),this},["Elem","DecoLine","Em","Ruby"].forEach((function(e){var t="render"+e;H.fn[t]=function(e){return H.normalize[t](this.context,e),this}})),we.extend(H.support,{heiti:!0,songti:H.detectFont('"Han Songti"'),"songti-gb":H.detectFont('"Han Songti GB"'),kaiti:H.detectFont('"Han Kaiti"'),fangsong:H.detectFont('"Han Fangsong"')}),H.correctBiaodian=function(e){var e=e||R,t=H.find(e);return t.avoid("h-char").replace(/([‘“])/g,(function(e){var t=H.createBDChar(e.text);return t.classList.add("bd-open","punct"),t})).replace(/([’”])/g,(function(e){var t=H.createBDChar(e.text);return t.classList.add("bd-close","bd-end","punct"),t})),H.support.unicoderange?t:t.charify({biaodian:!0})},H.correctBasicBD=H.correctBiaodian,H.correctBD=H.correctBiaodian,we.extend(H.fn,{biaodian:null,correctBiaodian:function(){return this.biaodian=H.correctBiaodian(this.context),this},revertCorrectedBiaodian:function(){try{this.biaodian.revert("all")}catch(e){}return this}}),H.fn.correctBasicBD=H.fn.correctBiaodian,H.fn.revertBasicBD=H.fn.revertCorrectedBiaodian;var _e="<<hws>>",ke=we.create("h-hws"),Ae;ke.setAttribute("hidden",""),ke.innerHTML=" ",we.extend(H,{renderHWS:function(e,t){var n=t?"textarea, code, kbd, samp, pre":"textarea",r=t?"strict":"base",e=e||R,i=H.find(e);return i.avoid(n).replace(H.TYPESET.hws[r][0],y).replace(H.TYPESET.hws[r][1],y).replace(new RegExp("("+_e+")+","g"),E).replace(/([\'"])\s(.+?)\s\1/g,w).replace(/\s[‘“]/g,x).replace(/[’”]\s/g,x).normalize(),i}}),we.extend(H.fn,{renderHWS:function(e){return H.renderHWS(this.context,e),this},revertHWS:function(){return we.tag("h-hws",this.context).forEach((function(e){we.remove(e)})),this.HWS=[],this}});var Le="bd-hangable",Me="h-char.bd-hangable",ze='<h-cs hidden class="jinze-outer hangable-outer"> </h-cs>',je=H.find.matches;H.support["han-space"]=C(),we.extend(H,{detectSpaceFont:C,isSpaceFontLoaded:C(),renderHanging:function(e){var e=e||R,t=H.find(e);return t.avoid("textarea, code, kbd, samp, pre").avoid(Me).replace(K.jinze.hanging,(function(e){if(/^[\x20\t\r\n\f]+$/.test(e.text))return"";var t=e.node.parentNode,n,r,i,o;return(n=we.parent(t,"h-jinze"))&&N(n),o=e.text.trim(),(r=H.createBDChar(o)).innerHTML="<h-inner>"+o+"</h-inner>",r.classList.add("bd-hangable"),(i=we.parent(t,"h-char.biaodian"))?(i.classList.add("bd-hangable"),je(t,"h-inner, h-inner *")?o:r.firstChild):r})),t}}),we.extend(H.fn,{renderHanging:function(){var e=this.condition.classList;return H.isSpaceFontLoaded=C(),H.isSpaceFontLoaded&&e.contains("no-han-space")&&(e.remove("no-han-space"),e.add("han-space")),H.renderHanging(this.context),this},revertHanging:function(){return we.qsa("h-char.bd-hangable, h-cs.hangable-outer",this.context).forEach((function(e){var t=e.classList;t.remove("bd-hangable"),t.remove("hangable-outer")})),this}});var Ie="bd-jiya",Re="h-char.bd-jiya",Oe="bd-consecutive",Pe='<h-cs hidden class="jinze-outer jiya-outer"> </h-cs>',je=H.find.matches,De,Fe;H.renderJiya=function(e){var e=e||R,t=H.find(e);return t.avoid("textarea, code, kbd, samp, pre, h-cs").avoid(Re).charify({avoid:!1,biaodian:T}).endAvoid().avoid("textarea, code, kbd, samp, pre, h-cs").replace(K.group.biaodian[0],_).replace(K.group.biaodian[1],_),t},we.extend(H.fn,{renderJiya:function(){return H.renderJiya(this.context),this},revertJiya:function(){return we.qsa("h-char.bd-jiya, h-cs.jiya-outer",this.context).forEach((function(e){var t=e.classList;t.remove("bd-jiya"),t.remove("jiya-outer")})),this}});var He="h-ru[annotation]",qe="textarea, code, kbd, samp, pre",Be=we.create("h-char","comb-liga");return we.extend(H,{isVowelCombLigaNormal:M(),isVowelICombLigaNormal:z(),isZhuyinCombLigaNormal:j(),isCombLigaNormal:z()(),substVowelCombLiga:I(H.TYPESET["display-as"]["comb-liga-vowel"]),substZhuyinCombLiga:I(H.TYPESET["display-as"]["comb-liga-zhuyin"]),substCombLigaWithPUA:I(H.TYPESET["display-as"]["comb-liga-pua"]),substInaccurateChar:function(e){var e=e||R,t=H.find(e);t.avoid(qe),H.TYPESET["inaccurate-char"].forEach((function(e){t.replace(new RegExp(e[0],"ig"),e[1])}))}}),we.extend(H.fn,{"comb-liga-vowel":null,"comb-liga-vowel-i":null,"comb-liga-zhuyin":null,"inaccurate-char":null,substVowelCombLiga:function(){return this["comb-liga-vowel"]=H.substVowelCombLiga(this.context),this},substVowelICombLiga:function(){return this["comb-liga-vowel-i"]=H.substVowelICombLiga(this.context),this},substZhuyinCombLiga:function(){return this["comb-liga-zhuyin"]=H.substZhuyinCombLiga(this.context),this},substCombLigaWithPUA:function(){return H.isVowelCombLigaNormal()?H.isVowelICombLigaNormal()||(this["comb-liga-vowel-i"]=H.substVowelICombLiga(this.context)):this["comb-liga-vowel"]=H.substVowelCombLiga(this.context),H.isZhuyinCombLigaNormal()||(this["comb-liga-zhuyin"]=H.substZhuyinCombLiga(this.context)),this},revertVowelCombLiga:function(){try{this["comb-liga-vowel"].revert("all")}catch(e){}return this},revertVowelICombLiga:function(){try{this["comb-liga-vowel-i"].revert("all")}catch(e){}return this},revertZhuyinCombLiga:function(){try{this["comb-liga-zhuyin"].revert("all")}catch(e){}return this},revertCombLigaWithPUA:function(){try{this["comb-liga-vowel"].revert("all"),this["comb-liga-vowel-i"].revert("all"),this["comb-liga-zhuyin"].revert("all")}catch(e){}return this},substInaccurateChar:function(){return this["inaccurate-char"]=H.substInaccurateChar(this.context),this},revertInaccurateChar:function(){try{this["inaccurate-char"].revert("all")}catch(e){}return this}}),e.addEventListener("DOMContentLoaded",(function(){var e;O.classList.contains("han-init")?H.init():(e=R.querySelector(".han-init-context"))&&(H.init=H(e).render())})),void 0!==t&&!1!==t||(e.Han=H),H}));